# Template file for 'systemd'
pkgname=systemd
version=255.2
revision=1
build_style=meson

# create log directories manually
# https://github.com/systemd/systemd/blob/57ffa99daae30375ec72a4c998d9c5b74a1f9023/src/journal/meson.build#L186-L199
configure_args="
 -Dmode=release
 -Drpmmacrosdir=no
 -Dman=true
 -Dcreate-log-dirs=true

 -Dtests=$([ "$XBPS_CHECK_PKGS" ] && echo true || echo false)

 -Ddefault-kill-user-processes=false

 -Dsbat-distro=void
 -Dsbat-distro-summary=VoidLinux
 -Dsbat-distro-pkgname=${pkgname}
 -Dsbat-distro-version=${version}_${revision}
 -Dsbat-distro-url=https://github.com/void-linux/void-packages/issues/

 $(vopt_bool efi)
 $(vopt_bool acl)
 $(vopt_bool apparmor)
 $(vopt_bool audit)
 $(vopt_bool blkid)
 $(vopt_bool fdisk)
 $(vopt_bool kmod)
 $(vopt_bool seccomp)
 $(: vopt_bool xen xenctrl)
 $(vopt_bool pam)
 $(vopt_bool microhttpd)
 $(vopt_bool cryptsetup libcryptsetup)
 $(vopt_bool cryptsetup_plugins libcryptsetup-plugins)
 $(vopt_bool curl libcurl)
 $(vopt_bool idn)
 $(vopt_bool idn libidn2)
 $(vopt_bool iptc libiptc)
 $(vopt_bool qrencode)
 $(vopt_bool gcrypt)
 $(vopt_bool gnutls)
 $(vopt_bool openssl)
 $(vopt_bool p11kit)
 $(vopt_bool fido2 libfido2)
 $(vopt_bool tpm2)
 $(vopt_bool elfutils)
 $(vopt_bool zlib)
 $(vopt_bool bzip2)
 $(vopt_bool xz)
 $(vopt_bool lz4)
 $(vopt_bool zstd)
 $(vopt_bool xkbcommon)
 $(vopt_bool pcre2)
"
#make_build_args=""
#make_install_args=""
#conf_files=""
#make_dirs="/var/log/dir 0755 root root"
hostmakedepends="
 gperf
 libxslt
 pkg-config
 python3-Jinja2
 docbook-xsl
 python3-pyelftools
 $(vopt_if bpf clang)"
makedepends="
 gnu-efi-libs
 libcap-devel
 libmount-devel

 $(vopt_if acl acl-devel)
 $(vopt_if apparmor libapparmor-devel)
 $(vopt_if audit libaudit-devel)
 $(vopt_if seccomp libseccomp-devel)
 $(vopt_if blkid libblkid-devel)
 $(vopt_if fdisk libfdisk-devel)
 $(vopt_if kmod libkmod-devel)
 $(: vopt_if xen xen-devel)
 $(vopt_if pam pam-devel)
 $(vopt_if pwquality libpwquality-devel)
 $(vopt_if microhttpd libmicrohttpd-devel)
 $(vopt_if cryptsetup cryptsetup-devel)
 $(vopt_if curl libcurl-devel)
 $(vopt_if idn libidn2-devel)
 $(vopt_if iptc iptables-devel)
 $(vopt_if qrencode qrencode-devel)
 $(vopt_if gcrypt libgcrypt-devel)

 $(vopt_if gnutls gnutls-devel)
 $(vopt_if openssl openssl-devel)
 $(vopt_if p11kit p11-kit-devel)
 $(vopt_if fido2 libfido2-devel)
 $(vopt_if tpm2 tpm2-tss-devel)
 $(vopt_if elfutils elfutils-devel)
 $(vopt_if zlib zlib-devel)
 $(vopt_if bzip2 bzip2-devel)
 $(vopt_if xz liblzma-devel)
 $(vopt_if lz4 liblz4-devel)
 $(vopt_if zstd libzstd-devel)
 $(vopt_if xkbcommon libxkbcommon-devel)
 $(vopt_if pcre2 pcre2-devel)
 $(vopt_if bpf libbpf-devel)"
checkdepends="python3-pefile acl-progs"
depends="
 systemd-analyze
 systemd-binfmt
 systemd-boot
 systemd-boot-efistub
 systemd-coredump
 systemd-cryptsetup
 systemd-firstboot
 systemd-hostnamed
 systemd-hwdb
 systemd-libudev
 systemd-localed
 systemd-logind
 systemd-oomd
 systemd-randomseed
 systemd-resolved
 systemd-sysusers
 systemd-tmpfiles
 systemd-udev
 systemd-vconsole-setup"
short_desc="System and Service Manager"
maintainer="Duncaen <duncaen@voidlinux.org>"
license="LGPL-2.1-or-later, GPL-2.0-or-later, MIT"
homepage="https://systemd.io/"
changelog="https://github.com/systemd/systemd-stable/raw/main/NEWS"
distfiles="https://github.com/systemd/systemd-stable/archive/refs/tags/v${version}.tar.gz"
checksum=ba7354a742dc9a8bb7dbeaa40cbf7cf2ca84f506d5b7ae5ab8d14c8eecb7aca0

if [ "$XBPS_TARGET_LIBC" = "glibc" ]; then
	makedepends+=" libxcrypt-devel"
fi

conf_files="
 /etc/systemd/journald.conf
 /etc/systemd/pstore.conf
 /etc/systemd/sleep.conf
 /etc/systemd/system.conf
 /etc/systemd/user.conf"

# XXX: split usr/lib/sysusers.d/systemd-remote.conf and move each sysuser
# to systemd-journal-remote and systemd-journal-upload.

build_options="
 efi
 bootloader
 acl
 apparmor
 audit
 blkid
 fdisk
 kmod
 seccomp
 xen
 pam
 pwquality
 microhttpd
 cryptsetup
 cryptsetup_plugins
 curl
 idn
 iptc
 qrencode
 gcrypt
 gnutls
 openssl
 p11kit
 fido2
 tpm2
 elfutils
 zlib
 bzip2
 xz
 lz4
 zstd
 xkbcommon
 pcre2
 bpf"
build_options_default="${build_options}"
desc_option_apparmor="Enable support for appamor"
desc_option_audit="Enable support for the linux audit framework"
desc_option_fdisk="Enable support for fdisk"
desc_option_cryptsetup="Enable support for cryptsetup"
desc_option_cryptsetup_plugins="Enable support for cryptsetup plugins"
desc_option_xz="Enable support for xz compression format"
desc_option_zlib="Enable support for gzip compression format"
desc_option_bzip2="Enable support for bzip2 compression format"
desc_option_xkbcommon="Enable support xkbcommon keymaps"
desc_option_pcre2="Enable support extended regexp using pcre2"

if [[ "$build_option_bootloader" && ! "$build_option_efi" ]]; then
	broken="bootloader build option requries efi build option"
fi

post_extract() {
	touch "${XBPS_WRAPPERDIR}/fsck"
	chmod +x "${XBPS_WRAPPERDIR}/fsck"
}

post_install() {
	rm -f usr/share/doc/systemd/LICENSE.GPL2 usr/share/doc/systemd/LICENSE.LGPL2.1
	rm -rf usr/share/doc/systemd/LICENSES
	vlicense LICENSES/MIT.txt
}

systemd-boot-efistub_package() {
	short_desc+=" - Simple UEFI kernel boot stub"
	pkg_install() {
		vmove "usr/lib/systemd/boot/efi/*"
		vmove "usr/share/man/man7/*.efi.stub.7"
		vmove usr/share/man/man7/sd-stub.7
		vmove usr/share/man/man7/systemd-stub.7
	}
}

systemd-boot_package() {
	short_desc+=" - Simple UEFI boot manager"
	depends="systemd-boot-efistub>=${version}_${revision}"
	pkg_install() {
		vmove usr/bin/bootctl
		vmove usr/lib/systemd/system-generators/systemd-bless-boot-generator
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-boot-random-seed.service
		vmove usr/lib/systemd/system/systemd-bless-boot.service
		vmove usr/lib/systemd/system/systemd-boot-update.service
		vmove usr/lib/systemd/systemd-bless-boot
		vmove usr/share/bash-completion/completions/bootctl
		vmove usr/share/man/man1/bootctl.1
		vmove usr/share/man/man8/systemd-bless-boot-generator.8
		vmove usr/share/man/man8/systemd-bless-boot.8
		vmove usr/share/man/man8/systemd-bless-boot.service.8
		vmove usr/share/man/man8/systemd-boot-random-seed.service.8
		vmove usr/share/zsh/site-functions/_bootctl
		vmove usr/lib/systemd/system/systemd-pcrphase-initrd.service
		vmove usr/lib/systemd/system/systemd-pcrphase-sysinit.service
		vmove usr/lib/systemd/system/systemd-pcrphase.service
		vmove usr/lib/systemd/systemd-pcrextend
		vmove usr/share/man/man8/systemd-pcrphase-initrd.service.8
		vmove usr/share/man/man8/systemd-pcrphase-sysinit.service.8
		vmove usr/share/man/man8/systemd-pcrextend.8
		vmove usr/share/man/man8/systemd-pcrphase.service.8
		vmove usr/lib/systemd/system/initrd.target.wants/systemd-pcrphase-initrd.service
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-pcrphase-sysinit.service
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-pcrphase.service
		vmove usr/lib/systemd/system/systemd-pcrfs-root.service
		vmove usr/lib/systemd/system/systemd-pcrfs@.service
		vmove usr/lib/systemd/system/systemd-pcrmachine.service
		vmove usr/lib/systemd/systemd-measure
		vmove usr/share/man/man1/systemd-measure.1
		vmove usr/share/man/man5/loader.conf.5
	}
}

systemd-firstboot_package() {
	short_desc+=" - Initialize basic system settings"
	pkg_install() {
		vmove usr/bin/systemd-firstboot
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-firstboot.service
		vmove usr/lib/systemd/system/systemd-firstboot.service
		vmove usr/share/man/man1/systemd-firstboot.1
		vmove usr/share/man/man1/systemd-firstboot.service.1
	}
}

systemd-randomseed_package() {
	short_desc+=" - Load and save the OS system random seed"
	pkg_install() {
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-random-seed.service
		vmove usr/lib/systemd/system/systemd-random-seed.service
		vmove usr/lib/systemd/systemd-random-seed
		vmove usr/share/man/man8/systemd-random-seed.8
		vmove usr/share/man/man8/systemd-random-seed.service.8
	}
}

systemd-coredump_package() {
	short_desc+=" - Acquire, save and process core dumps"
	conf_files="/etc/systemd/coredump.conf"
	pkg_install() {
		vmove "usr/lib/systemd/system/systemd-coredump*"
		vmove "usr/share/man/man5/coredump.conf*.5"
		vmove "usr/share/man/man8/systemd-coredump*.8"
		vmove etc/systemd/coredump.conf
		vmove usr/lib/sysctl.d/50-coredump.conf
		vmove usr/lib/systemd/system/sockets.target.wants/systemd-coredump.socket
		vmove usr/lib/systemd/systemd-coredump
		vmove usr/lib/sysusers.d/systemd-coredump.conf
	}
}

systemd-networkd_package() {
	short_desc+=" - Network manager"
	conf_files="/etc/systemd/networkd.conf"
	pkg_install() {
		vmove "usr/lib/systemd/network/*.network"
		vmove "usr/lib/systemd/system/systemd-networkd*"
		vmove "usr/lib/systemd/systemd-networkd*"
		vmove "usr/share/dbus-1/interfaces/org.freedesktop.network1.*.xml"
		vmove "usr/share/man/man5/networkd*.5"
		vmove "usr/share/man/man8/systemd-networkd*.8"
		vmove etc/systemd/networkd.conf
		vmove usr/bin/networkctl
		vmove usr/lib/sysusers.d/systemd-network.conf
		vmove usr/lib/tmpfiles.d/systemd-network.conf
		vmove usr/share/bash-completion/completions/networkctl
		vmove usr/share/dbus-1/system-services/org.freedesktop.network1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.network1.conf
		vmove usr/share/man/man1/networkctl.1
		vmove usr/share/man/man5/org.freedesktop.network1.5
		vmove usr/share/man/man5/systemd.netdev.5
		vmove usr/share/polkit-1/actions/org.freedesktop.network1.policy
		vmove usr/share/polkit-1/rules.d/systemd-networkd.rules
		vmove usr/share/zsh/site-functions/_networkctl
	}
}

systemd-oomd_package() {
	short_desc+=" - Userspace out-of-memory (OOM) killer"
	conf_files="/etc/systemd/oomd.conf"
	pkg_install() {
		vmove etc/systemd/oomd.conf
		vmove usr/bin/oomctl
		vmove usr/lib/systemd/system/systemd-oomd.service
		vmove usr/lib/systemd/system/systemd-oomd.socket
		vmove usr/lib/systemd/systemd-oomd
		vmove usr/lib/sysusers.d/systemd-oom.conf
		vmove usr/share/bash-completion/completions/oomctl
		vmove usr/share/dbus-1/interfaces/org.freedesktop.oom1.Manager.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.oom1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.oom1.conf
		vmove usr/share/man/man1/oomctl.1
		vmove usr/share/man/man5/oomd.conf.5
		vmove usr/share/man/man5/oomd.conf.d.5
		vmove usr/share/man/man5/org.freedesktop.oom1.5
		vmove usr/share/man/man8/systemd-oomd.8
		vmove usr/share/man/man8/systemd-oomd.service.8
		vmove usr/share/zsh/site-functions/_oomctl
	}
}

systemd-resolved_package() {
	short_desc+=" - Network Name Resolution manager"
	conf_files="/etc/systemd/resolved.conf"
	pkg_install() {
		# resolvectl and nss-resolve are in the main package.
		vmove etc/systemd/resolved.conf
		vmove usr/bin/resolvconf
		vmove usr/bin/systemd-resolve
		vmove usr/lib/systemd/system/systemd-resolved.service
		vmove usr/lib/systemd/systemd-resolved
		vmove usr/lib/sysusers.d/systemd-resolve.conf
		vmove usr/lib/tmpfiles.d/systemd-resolve.conf
		vmove usr/share/bash-completion/completions/systemd-resolve
		vmove usr/share/dbus-1/interfaces/org.freedesktop.resolve1.DnssdService.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.resolve1.Link.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.resolve1.Manager.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.resolve1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.resolve1.conf
		vmove usr/share/man/man5/org.freedesktop.resolve1.5
		vmove usr/share/man/man5/resolved.conf.5
		vmove usr/share/man/man5/resolved.conf.d.5
		vmove usr/share/man/man8/systemd-resolved.8
		vmove usr/share/man/man8/systemd-resolved.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.resolve1.policy
	}
}

systemd-timedated_package() {
	short_desc+=" - Time and date bus mechanism"
	pkg_install() {
		vmove usr/lib/systemd/system/dbus-org.freedesktop.timedate1.service
		vmove usr/lib/systemd/system/systemd-time-wait-sync.service
		vmove usr/lib/systemd/system/systemd-timedated.service
		vmove usr/lib/systemd/systemd-timedated
		vmove usr/share/dbus-1/interfaces/org.freedesktop.timedate1.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.timedate1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.timedate1.conf
		vmove usr/share/man/man5/org.freedesktop.timedate1.5
		vmove usr/share/man/man8/systemd-time-wait-sync.service.8
		vmove usr/share/man/man8/systemd-timedated.8
		vmove usr/share/man/man8/systemd-timedated.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.timedate1.policy
	}
}

systemd-timesyncd_package() {
	short_desc+=" - Network Time Synchronization"
	conf_files="/etc/systemd/timesyncd.conf"
	depends="systemd-timedated>=${version}_${revision}"
	pkg_install() {
		vmove etc/systemd/timesyncd.conf
		vmove usr/lib/systemd/ntp-units.d/80-systemd-timesync.list
		vmove usr/lib/systemd/system/systemd-timesyncd.service
		vmove usr/lib/systemd/systemd-timesyncd
		vmove usr/lib/sysusers.d/systemd-timesync.conf
		vmove usr/share/dbus-1/system-services/org.freedesktop.timesync1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.timesync1.conf
		vmove usr/share/man/man5/timesyncd.conf.5
		vmove usr/share/man/man5/timesyncd.conf.d.5
		vmove usr/share/man/man8/systemd-timesyncd.8
		vmove usr/share/man/man8/systemd-timesyncd.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.timesync1.policy
	}
}

systemd-userdbd_package() {
	short_desc+=" - JSON User/Group Record Query Multiplexer/NSS Compatibility"
	pkg_install() {
		vmove usr/bin/userdbctl
		vmove usr/lib/systemd/system/systemd-userdbd.service
		vmove usr/lib/systemd/system/systemd-userdbd.socket
		vmove usr/lib/systemd/systemd-userdbd
		vmove usr/lib/systemd/systemd-userwork
		vmove usr/share/man/man1/userdbctl.1
		vmove usr/share/man/man8/systemd-userdbd.8
		vmove usr/share/man/man8/systemd-userdbd.service.8
	}
}

systemd-hostnamed_package() {
	short_desc+=" - Daemon to control system hostname"
	pkg_install() {
		vmove usr/lib/systemd/system/dbus-org.freedesktop.hostname1.service
		vmove usr/lib/systemd/system/systemd-hostnamed.service
		vmove usr/lib/systemd/systemd-hostnamed
		vmove usr/share/dbus-1/interfaces/org.freedesktop.hostname1.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.hostname1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.hostname1.conf
		vmove usr/share/man/man5/org.freedesktop.hostname1.5
		vmove usr/share/man/man8/systemd-hostnamed.8
		vmove usr/share/man/man8/systemd-hostnamed.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.hostname1.policy
	}
}

systemd-logind_package() {
	short_desc+=" - Login manager"
	conf_files="/etc/systemd/logind.conf"
	pkg_install() {
		vmove etc/X11/xinit/xinitrc.d/50-systemd-user.sh
		vmove etc/systemd/logind.conf
		vmove usr/bin/systemd-inhibit
		vmove usr/lib/security/pam_systemd.so
		vmove usr/lib/systemd/system/dbus-org.freedesktop.login1.service
		vmove usr/lib/systemd/system/multi-user.target.wants/systemd-logind.service
		vmove usr/lib/systemd/system/systemd-logind.service
		vmove usr/lib/systemd/system/user-runtime-dir@.service
		vmove usr/lib/systemd/systemd-logind
		vmove usr/lib/systemd/systemd-user-runtime-dir
		vmove usr/share/dbus-1/interfaces/org.freedesktop.login1.Manager.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.login1.Seat.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.login1.Session.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.login1.User.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.login1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.login1.conf
		vmove usr/share/man/man1/systemd-inhibit.1
		vmove usr/share/man/man5/logind.conf.5
		vmove usr/share/man/man5/logind.conf.d.5
		vmove usr/share/man/man5/org.freedesktop.login1.5
		vmove usr/share/man/man5/systemd-user-runtime-dir.5
		vmove usr/share/man/man5/user-runtime-dir@.service.5
		vmove usr/share/man/man8/pam_systemd.8
		vmove usr/share/man/man8/systemd-logind.8
		vmove usr/share/man/man8/systemd-logind.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.login1.policy
		vmove usr/share/zsh/site-functions/_systemd-inhibit
	}
}

systemd-localed_package() {
	short_desc+=" - Locale bus mechanism"
	pkg_install() {
		vmove usr/lib/systemd/system/systemd-localed.service
		vmove usr/lib/systemd/systemd-localed
		vmove usr/share/dbus-1/interfaces/org.freedesktop.locale1.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.locale1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.locale1.conf
		vmove usr/share/factory/etc/locale.conf
		vmove usr/share/man/man5/locale.conf.5
		vmove usr/share/man/man5/org.freedesktop.locale1.5
		vmove usr/share/man/man8/systemd-localed.8
		vmove usr/share/man/man8/systemd-localed.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.locale1.policy
		vmove usr/lib/systemd/system/dbus-org.freedesktop.locale1.service
	}
}

systemd-machined_package() {
	short_desc+=" - Virtual machine and container registration manager"
	pkg_install() {
		vmove usr/lib/systemd/system/dbus-org.freedesktop.machine1.service
		vmove usr/lib/systemd/system/systemd-machined.service
		vmove usr/lib/systemd/systemd-machined
		vmove usr/share/dbus-1/interfaces/org.freedesktop.machine1.Image.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.machine1.Machine.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.machine1.Manager.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.machine1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.machine1.conf
		vmove usr/share/man/man5/org.freedesktop.machine1.5
		vmove usr/share/man/man8/systemd-machined.8
		vmove usr/share/man/man8/systemd-machined.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.machine1.policy
	}
}

systemd-portabled_package() {
	short_desc+=" - Portable service manager"
	pkg_install() {
		vmove usr/lib/systemd/portable/profile/default/service.conf
		vmove usr/lib/systemd/portable/profile/nonetwork/service.conf
		vmove usr/lib/systemd/portable/profile/strict/service.conf
		vmove usr/lib/systemd/portable/profile/trusted/service.conf
		vmove usr/lib/systemd/system/dbus-org.freedesktop.portable1.service
		vmove usr/lib/systemd/system/systemd-portabled.service
		vmove usr/lib/systemd/systemd-portabled
		vmove usr/lib/tmpfiles.d/portables.conf
		vmove usr/share/dbus-1/interfaces/org.freedesktop.portable1.Image.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.portable1.Manager.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.portable1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.portable1.conf
		vmove usr/share/man/man5/org.freedesktop.portable1.5
		vmove usr/share/man/man8/systemd-portabled.8
		vmove usr/share/man/man8/systemd-portabled.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.portable1.policy
	}
}

systemd-homed_package() {
	short_desc+=" - Home Area/User Account Manager"
	conf_files="/etc/systemd/homed.conf"
	pkg_install() {
		vmove etc/systemd/homed.conf
		vmove usr/lib/security/pam_systemd_home.so
		vmove usr/lib/systemd/system/systemd-homed-activate.service
		vmove usr/lib/systemd/system/systemd-homed.service
		vmove usr/lib/systemd/systemd-homed
		vmove usr/lib/systemd/systemd-homework
		vmove usr/share/dbus-1/interfaces/org.freedesktop.home1.Home.xml
		vmove usr/share/dbus-1/interfaces/org.freedesktop.home1.Manager.xml
		vmove usr/share/dbus-1/system-services/org.freedesktop.home1.service
		vmove usr/share/dbus-1/system.d/org.freedesktop.home1.conf
		vmove usr/share/man/man5/homed.conf.5
		vmove usr/share/man/man5/homed.conf.d.5
		vmove usr/share/man/man5/org.freedesktop.home1.5
		vmove usr/share/man/man8/pam_systemd_home.8
		vmove usr/share/man/man8/systemd-homed.8
		vmove usr/share/man/man8/systemd-homed.service.8
		vmove usr/share/polkit-1/actions/org.freedesktop.home1.policy
	}
}

systemd-hwdb_package() {
	short_desc+=" - Hardware database support"
	pkg_install() {
		vmove "usr/lib/udev/hwdb.d/*"
		vmove usr/bin/systemd-hwdb
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-hwdb-update.service
		vmove usr/lib/systemd/system/systemd-hwdb-update.service
		vmove usr/share/man/man7/hwdb.7
		vmove usr/share/man/man8/systemd-hwdb.8
	}
}

systemd-sysusers_package() {
	short_desc+=" - Hardware database support"
	pkg_install() {
		vmove usr/bin/systemd-sysusers
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-sysusers.service
		vmove usr/lib/systemd/system/systemd-sysusers.service
		vmove usr/share/man/man5/sysusers.d.5
		vmove usr/share/man/man8/systemd-sysusers.8
		vmove usr/share/man/man8/systemd-sysusers.service.8
	}
}

systemd-tmpfiles_package() {
	short_desc+=" - Creates, deletes and cleans up tmp-files and directories"
	pkg_install() {
		vmove usr/bin/systemd-tmpfiles
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-tmpfiles-setup-dev.service
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-tmpfiles-setup.service
		vmove usr/lib/systemd/system/systemd-tmpfiles-clean.service
		vmove usr/lib/systemd/system/systemd-tmpfiles-clean.timer
		vmove usr/lib/systemd/system/systemd-tmpfiles-setup-dev.service
		vmove usr/lib/systemd/system/systemd-tmpfiles-setup.service
		vmove usr/lib/systemd/system/timers.target.wants/systemd-tmpfiles-clean.timer
		vmove usr/lib/systemd/user/systemd-tmpfiles-clean.service
		vmove usr/lib/systemd/user/systemd-tmpfiles-clean.timer
		vmove usr/lib/systemd/user/systemd-tmpfiles-setup.service
		vmove usr/share/man/man5/tmpfiles.d.5
		vmove usr/share/man/man8/systemd-tmpfiles-clean.service.8
		vmove usr/share/man/man8/systemd-tmpfiles-clean.timer.8
		vmove usr/share/man/man8/systemd-tmpfiles-setup-dev.service.8
		vmove usr/share/man/man8/systemd-tmpfiles-setup.service.8
		vmove usr/share/man/man8/systemd-tmpfiles.8
		vmove usr/share/zsh/site-functions/_systemd-tmpfiles
	}
}

systemd-cryptsetup_package() {
	short_desc+=" - Disk decryption, integrity and verity support"
	pkg_install() {
		vmove usr/bin/systemd-cryptenroll
		vmove usr/lib/cryptsetup/libcryptsetup-token-systemd-fido2.so
		vmove usr/lib/cryptsetup/libcryptsetup-token-systemd-pkcs11.so
		vmove usr/lib/cryptsetup/libcryptsetup-token-systemd-tpm2.so
		vmove usr/lib/systemd/system-generators/systemd-cryptsetup-generator
		vmove usr/lib/systemd/system-generators/systemd-integritysetup-generator
		vmove usr/lib/systemd/system-generators/systemd-veritysetup-generator
		vmove usr/lib/systemd/system/cryptsetup-pre.target
		vmove usr/lib/systemd/system/cryptsetup.target
		vmove usr/lib/systemd/system/initrd-root-device.target.wants/remote-cryptsetup.target
		vmove usr/lib/systemd/system/integritysetup-pre.target
		vmove usr/lib/systemd/system/integritysetup.target
		vmove usr/lib/systemd/system/remote-cryptsetup.target
		vmove usr/lib/systemd/system/sysinit.target.wants/cryptsetup.target
		vmove usr/lib/systemd/system/sysinit.target.wants/integritysetup.target
		vmove usr/lib/systemd/system/system-systemd\\x2dcryptsetup.slice
		vmove usr/lib/systemd/system/system-systemd\\x2dveritysetup.slice
		vmove usr/lib/systemd/systemd-cryptsetup
		vmove usr/lib/systemd/systemd-integritysetup
		vmove usr/lib/systemd/systemd-veritysetup
		vmove usr/share/bash-completion/completions/systemd-cryptenroll
		vmove usr/share/man/man1/systemd-cryptenroll.1
		vmove usr/share/man/man8/systemd-cryptsetup-generator.8
		vmove usr/share/man/man8/systemd-cryptsetup.8
		vmove usr/share/man/man8/systemd-cryptsetup@.service.8
		vmove usr/share/man/man8/systemd-integritysetup-generator.8
		vmove usr/share/man/man8/systemd-integritysetup.8
		vmove usr/share/man/man8/systemd-integritysetup@.service.8
		vmove usr/share/man/man8/systemd-veritysetup-generator.8
		vmove usr/share/man/man8/systemd-veritysetup.8
		vmove usr/share/man/man8/systemd-veritysetup@.service.8
	}
}

systemd-sysvcompat_package() {
	short_desc+=" - SysV-init compatibility"
	pkg_install() {
		: vmove usr/lib/tmpfiles.d/legacy.conf # this creates /run/lock, keep it for now
		vmove usr/bin/halt
		vmove usr/bin/init
		vmove usr/bin/poweroff
		vmove usr/bin/reboot
		vmove usr/bin/runlevel
		vmove usr/bin/shutdown
		vmove usr/bin/telinit
		vmove usr/lib/systemd/system-generators/systemd-rc-local-generator
		vmove usr/lib/systemd/system-generators/systemd-sysv-generator
		vmove usr/lib/systemd/system/rc-local.service
		vmove usr/lib/systemd/system/runlevel0.target
		vmove usr/lib/systemd/system/runlevel1.target
		vmove usr/lib/systemd/system/runlevel2.target
		vmove usr/lib/systemd/system/runlevel3.target
		vmove usr/lib/systemd/system/runlevel4.target
		vmove usr/lib/systemd/system/runlevel5.target
		vmove usr/lib/systemd/system/runlevel6.target
		vmove usr/lib/systemd/system/sockets.target.wants/systemd-initctl.socket
		vmove usr/lib/systemd/system/systemd-initctl.service
		vmove usr/lib/systemd/system/systemd-initctl.socket
		vmove usr/lib/systemd/systemd-initctl
		vmove usr/share/man/man1/init.1
		vmove usr/share/man/man8/halt.8
		vmove usr/share/man/man8/poweroff.8
		vmove usr/share/man/man8/rc-local.service.8
		vmove usr/share/man/man8/reboot.8
		vmove usr/share/man/man8/runlevel.8
		vmove usr/share/man/man8/shutdown.8
		vmove usr/share/man/man8/systemd-initctl.8
		vmove usr/share/man/man8/systemd-initctl.service.8
		vmove usr/share/man/man8/systemd-initctl.socket.8
		vmove usr/share/man/man8/systemd-rc-local-generator.8
		vmove usr/share/man/man8/systemd-sysv-generator.8
		vmove usr/share/man/man8/telinit.8
	}
}

libsystemd_package() {
	short_desc+=" - library"
	license="LGPL-2.1-or-later"
	pkg_install() {
		vmove "usr/lib/libsystemd.so.*"
	}
}

libsystemd-devel_package() {
	short_desc+=" - development files"
	depends="libsystemd>=${version}_${revision}"
	license="LGPL-2.1-or-later"
	pkg_install() {
		vmove "usr/share/man/man3/SD_*.3"
		vmove "usr/share/man/man3/sd-*.3"
		vmove "usr/share/man/man3/sd_*.3"
		vmove usr/include/systemd
		vmove usr/lib/libsystemd.so
		vmove usr/lib/pkgconfig/libsystemd.pc
		vmove usr/share/man/man3/libsystemd.3
		vmove usr/share/pkgconfig/systemd.pc
	}
}

systemd-udev_package() {
	short_desc+=" - Device event managing daemon"
	conf_files="
	 /etc/udev/iocost.conf
	 /etc/udev/udev.conf"
	provides="eudev-${version}_${revision}"
	replaces="eudev>=0"
	pkg_install() {
		vmove etc/udev/iocost.conf
		vmove etc/udev/udev.conf
		vmove usr/bin/udevadm
		vmove usr/lib/systemd/system/initrd-udevadm-cleanup-db.service
		vmove usr/lib/systemd/system/sockets.target.wants/systemd-udevd-control.socket
		vmove usr/lib/systemd/system/sockets.target.wants/systemd-udevd-kernel.socket
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-udev-trigger.service
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-udevd.service
		vmove usr/lib/systemd/system/systemd-udev-settle.service
		vmove usr/lib/systemd/system/systemd-udev-trigger.service
		vmove usr/lib/systemd/system/systemd-udevd-control.socket
		vmove usr/lib/systemd/system/systemd-udevd-kernel.socket
		vmove usr/lib/systemd/system/systemd-udevd.service
		vmove usr/lib/systemd/systemd-udevd
		vmove usr/lib/tmpfiles.d/static-nodes-permissions.conf
		vmove usr/lib/udev
		vmove usr/share/bash-completion/completions/udevadm
		vmove usr/share/man/man5/systemd.link.5
		vmove usr/share/man/man5/udev.conf.5
		vmove usr/share/man/man7/udev.7
		vmove usr/share/man/man8/systemd-udev-settle.service.8
		vmove usr/share/man/man8/systemd-udevd-control.socket.8
		vmove usr/share/man/man8/systemd-udevd-kernel.socket.8
		vmove usr/share/man/man8/systemd-udevd.8
		vmove usr/share/man/man8/systemd-udevd.service.8
		vmove usr/share/man/man8/udevadm.8
		vmove usr/share/zsh/site-functions/_udevadm
	}
}

systemd-libudev_package() {
	short_desc+=" - API for enumerating and introspecting local devices"
	provides="eudev-libudev-${version}_${revision} libudev-${version}_${revision}"
	replaces="eudev-libudev>=0"
	pkg_install() {
		vmove "usr/lib/libudev.so.*"
	}
}

systemd-libudev-devel_package() {
	depends="systemd-libudev>=${version}_${revision}"
	short_desc+=" - development files"
	provides="eudev-libudev-devel-${version}_${revision} libudev-devel-${version}_${revision}"
	replaces="eudev-libudev-devel>=0"
	pkg_install() {
		vmove "usr/share/man/man3/udev_*.3"
		vmove usr/include/libudev.h
		vmove usr/lib/libudev.so
		vmove usr/lib/pkgconfig/libudev.pc
		vmove usr/share/man/man3/libudev.3
		vmove usr/share/pkgconfig/udev.pc
	}
}

systemd-vconsole-setup_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Configure the virtual consoles"
	pkg_install() {
		vmove usr/lib/systemd/system/systemd-vconsole-setup.service
		vmove usr/lib/systemd/systemd-vconsole-setup
		vmove usr/share/factory/etc/vconsole.conf
		vmove usr/share/man/man5/vconsole.conf.5
		vmove usr/share/man/man8/systemd-vconsole-setup.8
		vmove usr/share/man/man8/systemd-vconsole-setup.service.8
	}
}

systemd-analyze_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Analyze and debug system manager"
	pkg_install() {
		vmove usr/bin/systemd-analyze
		vmove usr/share/bash-completion/completions/systemd-analyze
		vmove usr/share/man/man1/systemd-analyze.1
		vmove usr/share/zsh/site-functions/_systemd-analyze
	}
}

systemd-kernel-install_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Add and remove kernel and initrd images"
	make_dirs="/etc/kernel 750 root root"
	pkg_install() {
		vmove usr/bin/kernel-install
		vmove usr/lib/kernel/install.conf
		vmove usr/lib/kernel/install.d/50-depmod.install
		vmove usr/lib/kernel/install.d/90-loaderentry.install
		vmove usr/lib/kernel/install.d/90-uki-copy.install
		vmove usr/share/bash-completion/completions/kernel-install
		vmove usr/share/man/man8/kernel-install.8
		vmove usr/share/zsh/site-functions/_kernel-install
	}
}

systemd-binfmt_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Configure additional binary formats"
	pkg_install() {
		vmove usr/lib/systemd/system/proc-sys-fs-binfmt_misc.automount
		vmove usr/lib/systemd/system/proc-sys-fs-binfmt_misc.mount
		vmove usr/lib/systemd/system/systemd-binfmt.service
		vmove usr/lib/systemd/systemd-binfmt
		vmove usr/share/man/man5/binfmt.d.5
		vmove usr/share/man/man8/systemd-binfmt.8
		vmove usr/share/man/man8/systemd-binfmt.service.8
		vmove usr/lib/systemd/system/sysinit.target.wants/proc-sys-fs-binfmt_misc.automount
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-binfmt.service

	}
}

systemd-journal-gatewayd_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - HTTP server for journal events"
	pkg_install() {
		vmove usr/lib/systemd/system/systemd-journal-gatewayd.service
		vmove usr/lib/systemd/system/systemd-journal-gatewayd.socket
		vmove usr/lib/systemd/systemd-journal-gatewayd
		vmove usr/share/man/man8/systemd-journal-gatewayd.8
		vmove usr/share/man/man8/systemd-journal-gatewayd.service.8
		vmove usr/share/man/man8/systemd-journal-gatewayd.socket.8
		vmove usr/share/systemd/gatewayd/browse.html
	}
}

systemd-journal-upload_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Send journal messages over the network"
	conf_files="/etc/systemd/journal-upload.conf"
	pkg_install() {
		vmove etc/systemd/journal-upload.conf
		vmove usr/lib/systemd/system/systemd-journal-upload.service
		vmove usr/lib/systemd/systemd-journal-upload
		vmove usr/share/man/man5/journal-upload.conf.5
		vmove usr/share/man/man5/journal-upload.conf.d.5
		vmove usr/share/man/man8/systemd-journal-upload.8
		vmove usr/share/man/man8/systemd-journal-upload.service.8
	}
}

systemd-journal-remote_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Receive journal messages over the network"
	conf_files="/etc/systemd/journal-remote.conf"
	pkg_install() {
		vmove etc/systemd/journal-remote.conf
		vmove usr/lib/systemd/system/systemd-journal-remote.service
		vmove usr/lib/systemd/system/systemd-journal-remote.socket
		vmove usr/lib/systemd/systemd-journal-remote
		vmove usr/share/man/man5/journal-remote.conf.5
		vmove usr/share/man/man5/journal-remote.conf.d.5
		vmove usr/share/man/man8/systemd-journal-remote.8
		vmove usr/share/man/man8/systemd-journal-remote.service.8
		vmove usr/share/man/man8/systemd-journal-remote.socket.8
	}
}

systemd-ukify_package() {
	depends="systemd>=${version}_${revision} python3-pefile"
	short_desc+=" - Signed Unified Kernel Image for UEFI systems"
	pkg_install() {
		vmove usr/bin/ukify
		vmove usr/lib/kernel/install.d/60-ukify.install
		vmove usr/lib/systemd/ukify
		vmove usr/share/man/man1/ukify.1
	}
}

systemd-sysext_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - System Extension Images"
	pkg_install() {
		vmove usr/bin/systemd-sysext
		vmove usr/lib/systemd/system/systemd-sysext.service
		vmove usr/share/bash-completion/completions/systemd-sysext
		vmove usr/share/man/man8/systemd-sysext.8
		vmove usr/share/man/man8/systemd-sysext.service.8
		vmove usr/bin/systemd-confext
	}
}

systemd-repart_package() {
	depends="systemd>=${version}_${revision}"
	short_desc+=" - Automatically grow and add partitions"
	pkg_install() {
		vmove usr/bin/systemd-repart
		vmove usr/lib/systemd/system/initrd-root-fs.target.wants/systemd-repart.service
		vmove usr/lib/systemd/system/sysinit.target.wants/systemd-repart.service
		vmove usr/lib/systemd/system/systemd-repart.service
		vmove usr/share/man/man5/repart.d.5
		vmove usr/share/man/man8/systemd-repart.8
		vmove usr/share/man/man8/systemd-repart.service.8
	}
}
